<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuratie - BBQ Admin</title>
    <meta name="description" content="Beheer applicatie configuratie">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Dynamic color customization -->
    <style>
        :root {
            --primary-color: {{ get_config_value('primary_color', '#FF8C00') }};
            --secondary-color: {{ get_config_value('secondary_color', '#FF6B35') }};
            --dark-bg: #1a1a1a;
            --darker-bg: #0f0f0f;
            --text-white: #ffffff;
            --text-light: #e0e0e0;
            --card-bg: #2a2a2a;
            --border-color: #404040;
        }
        
        body {
            background: var(--darker-bg);
            color: var(--text-white);
        }
        
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            background: var(--darker-bg);
            border: 2px solid var(--border-color);
            color: var(--text-white);
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: var(--primary-color);
        }
        
        .tab-button {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-light);
        }
        
        .tab-button.active {
            background: var(--primary-color);
            color: var(--text-white);
        }
        
        /* Config Sections */
        .config-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }
        
        /* Hero Image Thumbnail Styling */
        .current-image img {
            max-width: 200px;
            max-height: 120px;
            width: auto;
            height: auto;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            object-fit: cover;
        }
        
        .file-upload-preview img {
            max-width: 200px;
            max-height: 120px;
            width: auto;
            height: auto;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            object-fit: cover;
        }
        
        /* Benefits Grid Layout */
        .benefits-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .benefit-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .benefit-section h3 {
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        @media (max-width: 768px) {
            .benefits-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }
        
        /* Checkbox Styling */
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
            margin-bottom: 0.5rem;
        }
        
        .checkbox-label input[type="checkbox"] {
            margin-right: 0.5rem;
            transform: scale(1.2);
        }
        
        .checkmark {
            margin-left: 0.5rem;
        }
        
        .config-section h3 {
            margin: 0 0 1.5rem 0;
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .config-section .variables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        /* Variable Info Styling */
        .variable-info {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .variable-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .variable-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .variable-group h4 {
            margin: 0 0 0.75rem 0;
            color: var(--primary-color);
            font-size: 1rem;
            font-weight: 600;
        }
        
        .variable-group ul {
            margin: 0;
            padding-left: 1.2rem;
        }
        
        .variable-group li {
            margin-bottom: 0.5rem;
            color: var(--text-light);
        }
        
        .variable-group code {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: var(--primary-color);
            font-weight: 600;
        }
    </style>
    <!-- Simple Custom Editor - No external API needed -->
</head>
<body class="admin-page">
    <div class="admin-container">
        <div class="admin-header">
            <h1>‚öôÔ∏è Configuratie</h1>
            <div class="admin-nav">
                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">üìä Dashboard</a>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">üö™ Uitloggen</a>
            </div>
        </div>

        <!-- Configuration Tabs -->
        <div class="config-tabs">
            <button class="tab-button active" onclick="showTab('variables')">üìä Variabelen</button>
            <button class="tab-button" onclick="showTab('content')">üìù Content</button>
            <button class="tab-button" onclick="showTab('benefits')">‚≠ê Voordelen</button>
            <button class="tab-button" onclick="showTab('style')">üé® Stijl</button>
            <button class="tab-button" onclick="showTab('payment')">üí≥ Betaling</button>
            <button class="tab-button" onclick="showTab('email')">üìß E-Mail</button>
            <button class="tab-button" onclick="showTab('users')">üë• Gebruikers</button>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul class="flash-messages">
            {% for category, message in messages %}
              <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}

        <form action="{{ url_for('update_config') }}" method="POST" enctype="multipart/form-data" id="configForm">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="active_tab" id="active_tab_input" value="variables">
            
            <!-- Variables Tab -->
            <div id="variables-tab" class="tab-content active">
                <div class="card">
                    <h2>üìä Variabelen</h2>
                    <p class="tab-description">Deze variabelen worden automatisch vervangen in de hoofdinhoud van de pagina. Ze zorgen ervoor dat de informatie altijd actueel is.</p>
                    
                    <!-- Algemene Instellingen -->
                    <div class="config-section">
                        <h3>üè∑Ô∏è Algemene Instellingen</h3>
                        <div class="variables-grid">
                            {% for setting in configs.get('general', []) %}
                                {% if setting.key == 'app_title' %}
                                <div class="form-group">
                                    <label for="config_{{ setting.key }}">{{ setting.description }}</label>
                                    <input type="text" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or '' }}" placeholder="{{ setting.description }}">
                                    <small>Laatst bijgewerkt: {{ setting.updated_at }}</small>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- BBQ Evenement Details -->
                    <div class="config-section">
                        <h3>üéâ BBQ Evenement Details</h3>
                        <div class="variables-grid">
                            {% for setting in configs.get('bbq', []) %}
                                {% if setting.key != 'bbq_price_per_adult' %}
                                <div class="form-group">
                                    <label for="config_{{ setting.key }}">{{ setting.description }}</label>
                                    <input type="text" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or '' }}" placeholder="{{ setting.description }}">
                                    <small>Laatst bijgewerkt: {{ setting.updated_at }}</small>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Prijzen -->
                    <div class="config-section">
                        <h3>üí∞ Prijzen</h3>
                        <div class="variables-grid">
                            {% for setting in configs.get('variables', []) %}
                                {% if setting.key in ['price_per_adult', 'price_per_child'] %}
                                <div class="form-group">
                                    <label for="config_{{ setting.key }}">{{ setting.description }}</label>
                                    <input type="number" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or '' }}" step="0.01" placeholder="{{ setting.description }}">
                                    <small>Laatst bijgewerkt: {{ setting.updated_at }}</small>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Variabelen Uitleg -->
                    <div class="variable-info">
                        <h3>üîç Hoe variabelen werken</h3>
                        <p>Deze variabelen kunnen gebruikt worden in de hoofdinhoud en e-mails:</p>
                        <div class="variable-list">
                            <div class="variable-group">
                                <h4>üìÖ Datum & Locatie</h4>
                                <ul>
                                    <li><code>{date}</code> - BBQ datum</li>
                                    <li><code>{location}</code> - BBQ locatie</li>
                                    <li><code>{deadline}</code> - Aanmelddeadline</li>
                                </ul>
                            </div>
                            <div class="variable-group">
                                <h4>üí∞ Prijzen</h4>
                                <ul>
                                    <li><code>{price}</code> - Prijs per volwassene</li>
                                    <li><code>{price_adult}</code> - Prijs per volwassene (alternatief)</li>
                                    <li><code>{price_child}</code> - Prijs per kind</li>
                                </ul>
                            </div>
                            <div class="variable-group">
                                <h4>üìû Contact</h4>
                                <ul>
                                    <li><code>{contact_phone}</code> - Contact telefoonnummer</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content Tab -->
            <div id="content-tab" class="tab-content">
                <div class="card">
                    <h2>üìù Content</h2>
                    <p class="tab-description">Beheer de hoofdinhoud van de aanmeldpagina. Gebruik de knoppen om tekst te formatteren en variabelen in te voegen.</p>
                    
                    <!-- Hero Configuration -->
                    <div class="config-section">
                        <h3>üéØ Hero Sectie</h3>
                        <div class="variables-grid">
                            <div class="form-group">
                                <label for="config_hero_title">Hero Titel</label>
                                <input type="text" id="config_hero_title" name="config_hero_title" value="{{ get_config_value('hero_title', '') }}" placeholder="Hero titel op de hoofdpagina">
                                <small>De grote titel die bovenaan de pagina wordt getoond</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="config_hero_subtitle">Hero Ondertitel</label>
                                <textarea id="config_hero_subtitle" name="config_hero_subtitle" rows="3" placeholder="Hero ondertitel op de hoofdpagina">{{ get_config_value('hero_subtitle', '') }}</textarea>
                                <small>De ondertitel die onder de hero titel wordt getoond</small>
                            </div>
                        </div>
                        
                        <!-- Hero Image Upload -->
                        <div class="form-group" style="margin-top: 2rem;">
                            <label for="hero_image">üñºÔ∏è Hero Afbeelding</label>
                            <div class="file-upload-container">
                                <input type="file" id="hero_image" name="hero_image" accept="image/*" onchange="previewHeroImage(this)">
                                <div class="file-upload-preview" id="heroImagePreview" style="display: none;">
                                    <img id="previewHeroImg" src="" alt="Preview">
                                    <button type="button" onclick="removeHeroImage()" class="btn btn-small btn-danger">üóëÔ∏è Verwijder</button>
                                </div>
                                <div class="current-image" id="currentHeroImage" style="display: none;">
                                    <p>Huidige hero afbeelding:</p>
                                    <img id="currentHeroImg" src="" alt="Current hero">
                                </div>
                            </div>
                            <small>Upload een nieuwe hero afbeelding (JPG, PNG, GIF). Maximaal 5MB.</small>
                        </div>
                    </div>
                    
                    <!-- Not Planned Mode Configuration -->
                    <div class="config-section">
                        <h3>üìÖ Niet Gepland Modus</h3>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="config_not_planned_mode" name="config_not_planned_mode" value="1" {% if get_config_value('not_planned_mode', '0') == '1' %}checked{% endif %}>
                                <span class="checkmark"></span>
                                Activeren wanneer BBQ niet gepland is
                            </label>
                            <small>Wanneer geactiveerd wordt het aanmeldformulier verborgen en wordt alternatieve tekst getoond</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="config_not_planned_text">üìù Alternatieve Tekst (Niet Gepland Modus)</label>
                            <textarea id="config_not_planned_text" name="config_not_planned_text" rows="4" placeholder="Tekst die wordt getoond wanneer BBQ niet gepland is">{{ get_config_value('not_planned_text', 'De volgende BBQ is nog niet gepland. Houd deze pagina in de gaten voor updates!') }}</textarea>
                            <small>Deze tekst wordt getoond in plaats van het aanmeldformulier wanneer de niet gepland modus actief is</small>
                        </div>
                    </div>
                    
                    <!-- Main Content -->
                    <div class="config-section">
                        <h3>üìÑ Hoofdinhoud</h3>
                        {% for setting in configs.get('content', []) %}
                            {% if setting.key == 'main_content' %}
                            <div class="form-group">
                                <label for="config_{{ setting.key }}">{{ setting.description }}</label>
                                <div class="simple-editor">
                                    <div class="editor-toolbar">
                                        <button type="button" class="btn-toolbar" onclick="formatText('bold')" title="Vet">B</button>
                                        <button type="button" class="btn-toolbar" onclick="formatText('italic')" title="Cursief">I</button>
                                        <button type="button" class="btn-toolbar" onclick="formatText('underline')" title="Onderstrepen">U</button>
                                        <span class="toolbar-separator">|</span>
                                        <button type="button" class="btn-toolbar btn-variable" onclick="insertVariable('{date}')" title="Datum">üìÖ Datum</button>
                                        <button type="button" class="btn-toolbar btn-variable" onclick="insertVariable('{location}')" title="Locatie">üìç Locatie</button>
                                        <button type="button" class="btn-toolbar btn-variable" onclick="insertVariable('{price}')" title="Prijs">üí∞ Prijs</button>
                                        <button type="button" class="btn-toolbar btn-variable" onclick="insertVariable('{deadline}')" title="Deadline">‚è∞ Deadline</button>
                                    </div>
                                    <textarea id="config_{{ setting.key }}" name="config_{{ setting.key }}" rows="12" placeholder="{{ setting.description }}">{{ setting.value or '' }}</textarea>
                                    <small><strong>Tip:</strong> Gebruik de knoppen hierboven om tekst te formatteren en variabelen in te voegen. De variabelen worden automatisch vervangen door de juiste waarden.</small>
                                </div>
                                <small>Laatst bijgewerkt: {{ setting.updated_at }}</small>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Benefits Tab -->
            <div id="benefits-tab" class="tab-content">
                <div class="card">
                    <h2>‚≠ê Voordelen</h2>
                    <p class="tab-description">Configureer de 4 voordelen die op de hoofdpagina worden getoond.</p>
                    
                    <div class="config-section">
                        <h3>üéØ Voordelen Configuratie</h3>
                        <div class="benefits-grid">
                        <!-- Benefit 1 -->
                        <div class="benefit-section">
                            <h3>üéØ Voordeel 1</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="config_benefit_1_icon">Icoon</label>
                                    <input type="text" id="config_benefit_1_icon" name="config_benefit_1_icon" value="{{ get_config_value('benefit_1_icon', 'üçñ') }}" placeholder="Bijv. üçñ">
                                    <small>Emoji of symbool voor dit voordeel</small>
                                </div>
                                <div class="form-group">
                                    <label for="config_benefit_1_title">Titel</label>
                                    <input type="text" id="config_benefit_1_title" name="config_benefit_1_title" value="{{ get_config_value('benefit_1_title', '') }}" placeholder="Titel van voordeel 1">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="config_benefit_1_description">Beschrijving</label>
                                <textarea id="config_benefit_1_description" name="config_benefit_1_description" rows="2" placeholder="Beschrijving van voordeel 1">{{ get_config_value('benefit_1_description', '') }}</textarea>
                            </div>
                        </div>
                        
                        <!-- Benefit 2 -->
                        <div class="benefit-section">
                            <h3>üéØ Voordeel 2</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="config_benefit_2_icon">Icoon</label>
                                    <input type="text" id="config_benefit_2_icon" name="config_benefit_2_icon" value="{{ get_config_value('benefit_2_icon', 'üë•') }}" placeholder="Bijv. üë•">
                                    <small>Emoji of symbool voor dit voordeel</small>
                                </div>
                                <div class="form-group">
                                    <label for="config_benefit_2_title">Titel</label>
                                    <input type="text" id="config_benefit_2_title" name="config_benefit_2_title" value="{{ get_config_value('benefit_2_title', '') }}" placeholder="Titel van voordeel 2">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="config_benefit_2_description">Beschrijving</label>
                                <textarea id="config_benefit_2_description" name="config_benefit_2_description" rows="2" placeholder="Beschrijving van voordeel 2">{{ get_config_value('benefit_2_description', '') }}</textarea>
                            </div>
                        </div>
                        
                        <!-- Benefit 3 -->
                        <div class="benefit-section">
                            <h3>üéØ Voordeel 3</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="config_benefit_3_icon">Icoon</label>
                                    <input type="text" id="config_benefit_3_icon" name="config_benefit_3_icon" value="{{ get_config_value('benefit_3_icon', 'üéâ') }}" placeholder="Bijv. üéâ">
                                    <small>Emoji of symbool voor dit voordeel</small>
                                </div>
                                <div class="form-group">
                                    <label for="config_benefit_3_title">Titel</label>
                                    <input type="text" id="config_benefit_3_title" name="config_benefit_3_title" value="{{ get_config_value('benefit_3_title', '') }}" placeholder="Titel van voordeel 3">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="config_benefit_3_description">Beschrijving</label>
                                <textarea id="config_benefit_3_description" name="config_benefit_3_description" rows="2" placeholder="Beschrijving van voordeel 3">{{ get_config_value('benefit_3_description', '') }}</textarea>
                            </div>
                        </div>
                        
                        <!-- Benefit 4 -->
                        <div class="benefit-section">
                            <h3>üéØ Voordeel 4</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="config_benefit_4_icon">Icoon</label>
                                    <input type="text" id="config_benefit_4_icon" name="config_benefit_4_icon" value="{{ get_config_value('benefit_4_icon', 'üí∞') }}" placeholder="Bijv. üí∞">
                                    <small>Emoji of symbool voor dit voordeel</small>
                                </div>
                                <div class="form-group">
                                    <label for="config_benefit_4_title">Titel</label>
                                    <input type="text" id="config_benefit_4_title" name="config_benefit_4_title" value="{{ get_config_value('benefit_4_title', '') }}" placeholder="Titel van voordeel 4">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="config_benefit_4_description">Beschrijving</label>
                                <textarea id="config_benefit_4_description" name="config_benefit_4_description" rows="2" placeholder="Beschrijving van voordeel 4">{{ get_config_value('benefit_4_description', '') }}</textarea>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Style Tab -->
            <div id="style-tab" class="tab-content">
                <div class="card">
                    <h2>üé® Stijl</h2>
                    <p class="tab-description">Pas de kleuren en achtergrond van de applicatie aan om het aan te passen aan uw huisstijl.</p>
                    
                    
                    <!-- Color Settings -->
                    <div class="config-section">
                        <h3>üé® Kleuren</h3>
                        <div class="variables-grid">
                            {% for setting in configs.get('appearance', []) %}
                                {% if setting.key not in ['hero_image'] %}
                                <div class="form-group">
                                    <label for="config_{{ setting.key }}">{{ setting.description }}</label>
                                    {% if setting.key in ['primary_color', 'secondary_color'] %}
                                        <input type="color" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or (setting.key == 'primary_color' and '#FF8C00' or '#FF6B35') }}">
                                    {% else %}
                                        <input type="text" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or '' }}" placeholder="{{ setting.description }}">
                                    {% endif %}
                                    <small>Laatst bijgewerkt: {{ setting.updated_at }}</small>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Style-specific actions -->
                    <div class="config-section">
                        <h3>‚öôÔ∏è Acties</h3>
                        <div class="style-actions">
                            <button type="button" onclick="resetStyleToDefaults()" class="btn btn-warning">üîÑ Reset Stijl naar Standaard</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Payment Tab -->
            <div id="payment-tab" class="tab-content">
                <div class="card">
                    <h2>üí≥ Betaling</h2>
                    <p class="tab-description">Configureer de betaalmethode voor aanmeldingen. Kies tussen geen betalingsintegratie of Bunq.me.</p>
                    
                    <!-- Payment Configuration -->
                    <div class="config-section">
                        <h3>‚öôÔ∏è Betaalconfiguratie</h3>
                        <div class="variables-grid">
                            <!-- Payment Method Selection -->
                            <div class="form-group">
                                <label for="config_payment_method">üí≥ Betaalmethode</label>
                                <select id="config_payment_method" name="config_payment_method" onchange="togglePaymentFields()">
                                    <option value="none" {% if get_config_value('payment_method', 'none') == 'none' %}selected{% endif %}>Geen betalingsintegratie</option>
                                    <option value="bunq" {% if get_config_value('payment_method', 'none') == 'bunq' %}selected{% endif %}>Bunq.me</option>
                                </select>
                                <small>Kies hoe gebruikers kunnen betalen na aanmelding.</small>
                            </div>
                            
                            <!-- Bunq.me Link (only shown when bunq is selected) -->
                            <div class="form-group" id="bunq_link_group" style="display: none;">
                                <label for="config_bunq_me_link">üîó Bunq.me Betaallink</label>
                                <input type="url" id="config_bunq_me_link" name="config_bunq_me_link" value="{{ get_config_value('bunq_me_link', '') }}" placeholder="https://bunq.me/your-link">
                                <small>Voer uw Bunq.me betaallink in (zonder bedrag en beschrijving).</small>
                            </div>
                            
                            <!-- No Payment Message (only shown when none is selected) -->
                            <div class="form-group" id="no_payment_message_group" style="display: none;">
                                <label for="config_no_payment_message">üìù Bericht bij geen betaling</label>
                                <textarea id="config_no_payment_message" name="config_no_payment_message" rows="3" placeholder="Bericht dat gebruikers zien na aanmelding">{{ get_config_value('no_payment_message', 'Uw aanmelding is succesvol ontvangen! Wij nemen binnenkort contact met u op voor de betaling.') }}</textarea>
                                <small>Dit bericht wordt getoond aan gebruikers wanneer er geen betalingsintegratie is.</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment Method Info -->
                    <div class="config-section">
                        <h3>‚ÑπÔ∏è Informatie over betaalmethoden</h3>
                        <div class="payment-method-info">
                            <div class="method-card">
                                <h4>üö´ Geen betalingsintegratie</h4>
                                <p>Gebruikers krijgen een bevestigingsbericht en u neemt later contact op voor de betaling. Geschikt voor kleine evenementen of wanneer u de betaling handmatig wilt afhandelen.</p>
                            </div>
                            <div class="method-card">
                                <h4>üí≥ Bunq.me</h4>
                                <p>Gebruikers worden automatisch doorgestuurd naar een Bunq.me betaallink. U moet een Bunq.me account hebben en een betaallink aanmaken. Het bedrag en de beschrijving worden automatisch toegevoegd.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Email Tab -->
            <div id="email-tab" class="tab-content">
                <div class="card">
                    <h2>üìß E-Mail</h2>
                    <p class="tab-description">Configureer de e-mail instellingen voor het versturen van bevestigingen en notificaties.</p>
                    
                    <div class="config-section">
                        <h3>‚öôÔ∏è E-Mail Configuratie</h3>
                        <div class="variables-grid">
                            {% for setting in configs.get('email', []) %}
                            <div class="form-group">
                                <label for="config_{{ setting.key }}">{{ setting.description }}</label>
                                {% if setting.key == 'smtp_password' %}
                                    <input type="password" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or '' }}" placeholder="{{ setting.description }}">
                                {% elif setting.key == 'smtp_port' %}
                                    <input type="number" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or '' }}" placeholder="{{ setting.description }}">
                                {% else %}
                                    <input type="text" id="config_{{ setting.key }}" name="config_{{ setting.key }}" value="{{ setting.value or '' }}" placeholder="{{ setting.description }}">
                                {% endif %}
                                <small>Laatst bijgewerkt: {{ setting.updated_at }}</small>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <div class="card">
                    <h2>üë• Gebruikersbeheer</h2>
                    <p class="tab-description">Beheer admin gebruikers die toegang hebben tot het beheerpaneel. U kunt nieuwe gebruikers aanmaken, wachtwoorden bijwerken en gebruikers verwijderen.</p>
                    
                    <div class="config-section">
                        <h3>‚ûï Nieuwe Admin Gebruiker</h3>
                        <div class="user-form">
                            <div id="userForm">
                            <div class="form-group-inline">
                                <div class="input-inline">
                                    <label for="username">üë§ Gebruikersnaam *</label>
                                    <input type="text" id="username" required placeholder="Gebruikersnaam">
                                </div>
                                <div class="input-inline">
                                    <label for="email">üìß E-mailadres</label>
                                    <input type="email" id="email" placeholder="email@voorbeeld.nl">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="password">üîí Wachtwoord *</label>
                                <input type="password" id="password" required placeholder="Wachtwoord">
                            </div>
                            
                            <button type="button" onclick="createUser()" class="btn btn-success">‚ûï Admin Gebruiker Aanmaken</button>
                        </div>
                    </div>
                    
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3>üë• Bestaande Admin Gebruikers</h3>
                        <div class="user-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>üë§ Gebruikersnaam</th>
                                        <th>üìß E-mail</th>
                                        <th>üìÖ Aangemaakt</th>
                                        <th>‚úÖ Status</th>
                                        <th>‚öôÔ∏è Acties</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for admin in admins %}
                                    <tr>
                                        <td>{{ admin.username }}</td>
                                        <td>{{ admin.email or 'Niet ingesteld' }}</td>
                                        <td>{{ admin.created_at }}</td>
                                        <td class="status-{{ 'active' if admin.is_active else 'inactive' }}">
                                            {{ 'Actief' if admin.is_active else 'Inactief' }}
                                        </td>
                                        <td>
                                            {% if admin.is_active %}
                                            <div class="admin-actions">
                                                <button onclick="showPasswordModal({{ admin.id }}, '{{ admin.username }}')" class="btn btn-small btn-warning">üîë Wachtwoord</button>
                                                {% if admins|length > 1 %}
                                                <form action="{{ url_for('delete_admin_user', admin_id=admin.id) }}" method="POST" style="display: inline;">
                                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                                    <button type="submit" onclick="return confirm('Weet je zeker dat je deze admin gebruiker wilt verwijderen?')" class="btn btn-small btn-danger">üóëÔ∏è Verwijder</button>
                                                </form>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="5">Geen admin gebruikers gevonden.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        
        <!-- Save Button - Centered -->
        <div class="save-button-container">
            <button type="submit" form="configForm" class="btn btn-primary btn-save" onclick="handleFormSubmit(); return false;">üíæ Configuratie Opslaan</button>
        </div>
        
        <!-- Separate form for user management -->
        <form action="{{ url_for('create_admin_user') }}" method="POST" id="createUserForm" style="display: none;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="username" id="hidden_username">
            <input type="hidden" name="email" id="hidden_email">
            <input type="hidden" name="password" id="hidden_password">
        </form>
    </div>

    <!-- Password Update Modal -->
    <div id="passwordModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" onclick="closePasswordModal()">&times;</span>
            <h2>üîë Wachtwoord Bijwerken</h2>
            <form id="passwordForm" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                
                <div class="form-group">
                    <label for="new_password">üîí Nieuw Wachtwoord *</label>
                    <input type="password" id="new_password" name="new_password" required placeholder="Nieuw wachtwoord">
                </div>
                
                <div class="form-group">
                    <label for="confirm_password">üîí Bevestig Wachtwoord *</label>
                    <input type="password" id="confirm_password" name="confirm_password" required placeholder="Bevestig wachtwoord">
                </div>
                
                <button type="submit" class="btn btn-primary">üíæ Wachtwoord Bijwerken</button>
            </form>
        </div>
    </div>

    <script>
        // Tab functionality
        function showTab(tabName) {
            // Update the hidden input with the current tab name
            document.getElementById('active_tab_input').value = tabName;

            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        function togglePaymentFields() {
            const paymentMethod = document.getElementById('config_payment_method').value;
            const bunqLinkGroup = document.getElementById('bunq_link_group');
            const noPaymentMessageGroup = document.getElementById('no_payment_message_group');
            
            if (paymentMethod === 'bunq') {
                bunqLinkGroup.style.display = 'block';
                noPaymentMessageGroup.style.display = 'none';
            } else {
                bunqLinkGroup.style.display = 'none';
                noPaymentMessageGroup.style.display = 'block';
            }
        }
        
        // On page load, check for a hash in the URL and show the correct tab
        document.addEventListener('DOMContentLoaded', function() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                const tabButton = document.querySelector(`.tab-button[onclick="showTab('${hash}')"]`);
                if (tabButton) {
                    tabButton.click();
                }
            }
            
            // Initialize payment fields visibility
            togglePaymentFields();
        });

        // Simple Custom Editor Functions
        function formatText(command) {
            const textarea = document.getElementById('config_main_content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let formattedText = '';
            switch(command) {
                case 'bold':
                    formattedText = `<strong>${selectedText}</strong>`;
                    break;
                case 'italic':
                    formattedText = `<em>${selectedText}</em>`;
                    break;
                case 'underline':
                    formattedText = `<u>${selectedText}</u>`;
                    break;
            }
            
            // Replace selected text with formatted text
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            
            // Set cursor position after the formatted text
            const newPosition = start + formattedText.length;
            textarea.setSelectionRange(newPosition, newPosition);
            textarea.focus();
        }
        
        function insertVariable(variable) {
            const textarea = document.getElementById('config_main_content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            
            // Insert variable at cursor position
            textarea.value = textarea.value.substring(0, start) + variable + textarea.value.substring(end);
            
            // Set cursor position after the variable
            const newPosition = start + variable.length;
            textarea.setSelectionRange(newPosition, newPosition);
            textarea.focus();
        }
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                const textarea = document.getElementById('config_main_content');
                if (document.activeElement === textarea) {
                    switch(e.key) {
                        case 'b':
                            e.preventDefault();
                            formatText('bold');
                            break;
                        case 'i':
                            e.preventDefault();
                            formatText('italic');
                            break;
                        case 'u':
                            e.preventDefault();
                            formatText('underline');
                            break;
                    }
                }
            }
        });
        
        // Password Modal Functions
        function showPasswordModal(adminId, username) {
            document.getElementById('passwordForm').action = `/admin/users/update_password/${adminId}`;
            document.querySelector('#passwordModal h2').textContent = `üîë Wachtwoord Bijwerken - ${username}`;
            document.getElementById('passwordModal').style.display = 'flex';
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('passwordForm').reset();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('passwordModal');
            if (event.target == modal) {
                closePasswordModal();
            }
        }

        // Password confirmation validation
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            const password = document.getElementById('new_password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Wachtwoorden komen niet overeen!');
            }
        });

        // Image upload preview functionality
        function previewHeroImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('heroImagePreview');
                    const previewImg = document.getElementById('previewHeroImg');
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                    // Hide current image when previewing new one
                    const currentImage = document.getElementById('currentHeroImage');
                    currentImage.style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeHeroImage() {
            const input = document.getElementById('hero_image');
            const preview = document.getElementById('heroImagePreview');
            input.value = '';
            preview.style.display = 'none';
            // Show current image again
            const currentImage = document.getElementById('currentHeroImage');
            currentImage.style.display = 'block';
        }

        // Show current hero image on page load
        function showCurrentHeroImage() {
            const currentImage = document.getElementById('currentHeroImage');
            const currentImg = document.getElementById('currentHeroImg');
            const heroImageValue = '{{ get_config_value("hero_image", "") }}';
            
            if (heroImageValue && heroImageValue !== '') {
                currentImg.src = '/static/' + heroImageValue;
                currentImage.style.display = 'block';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            showCurrentHeroImage();
        });

        // Reset style to defaults functionality
        function resetStyleToDefaults() {
            if (confirm('Weet je zeker dat je de stijl instellingen wilt resetten naar de standaardwaarden? Dit kan niet ongedaan worden gemaakt.')) {
                // Create a form to submit reset request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '{{ url_for("reset_style_config") }}';
                
                const csrfToken = document.createElement('input');
                csrfToken.type = 'hidden';
                csrfToken.name = 'csrf_token';
                csrfToken.value = '{{ csrf_token() }}';
                form.appendChild(csrfToken);
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Form submission handler
        function handleFormSubmit() {
            const configForm = document.getElementById('configForm');
            if (configForm) {
                // Show loading state
                const submitBtn = configForm.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'üíæ Opslaan...';
                }
                
                // Submit the form
                configForm.submit();
            }
        }

        // Create user function
        function createUser() {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (!username || !password) {
                alert('Gebruikersnaam en wachtwoord zijn verplicht.');
                return;
            }

            // Populate hidden form
            document.getElementById('hidden_username').value = username;
            document.getElementById('hidden_email').value = email;
            document.getElementById('hidden_password').value = password;

            // Submit the hidden form
            document.getElementById('createUserForm').submit();
        }
    </script>
</body>
</html>
